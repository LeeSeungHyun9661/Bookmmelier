{% extends 'base.html' %}

{% block style%}
<script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.js"></script>
{% endblock %}

{% block content %}
<div class="content">
    <!-- 제목 부분 -->
    <div class="header">
        <h2>서평 수정 : {{review.review_id}}</h2>
    </div>
    <a href="#" data-toggle="modal" data-target="#myModal">도서 불러오기</a>    

    <!-- 모달 -->
    <div class="modal fade" id="myModal" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-xl modal-dialog-centered">
          <div class="modal-content">
          
            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">도서 검색</h4>
                <div>
                    <select name="search_type" id="search_type">
                        <option value="전체">전체</option>
                        <option value="제목">제목</option>
                        <option value="작가">작가</option>
                        <option value="출판사">출판사</option>
                    </select>
                    <input id="search_input" type="search"/>
                    <button id="search_button" type="submit">검색</button>      
                </div>
                                
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
    
            <!-- Modal body -->
            <div class="modal-body"  id="table">
                {% include 'review_write_search.html' %}
            </div>           
            
            <!-- Modal footer -->
            <div class="modal-footer">   
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
            
          </div>
        </div>
    </div>    
    <div id="modal"></div>   
    
    <!-- 서평 작성 부분 -->
    <form id="upload_review" method="POST">
        {% csrf_token %}  
        <div id="selected_book">
            {% if selected_book %}
                <h2>선택된 도서</h2>
                <a>제목 : {{selected_book.title}}</a><br>
                <a>작가 : {{selected_book.author}}</a><br>
                <a>출판사{{selected_book.publisher}}</a><br>
                <input type="hidden" name="isbn13" id="isbn13" value = "{{selected_book.isbn13}}">
            {%endif%}
        </div>

        {{forms|safe}}

        <button  type="submit" >작성완료</button>
    </form>

</div>

<script>
    $('#upload_review').on('submit',function(){
        event.preventDefault();
        form_array  = $(this).serialize();        
        // 도서가 선택되지 않은 경우, 오류 반환

        
        alert('{{review.review_id}}')

        if ($('#isbn13').val() === undefined) alert("도서를 선택해주세요") 
        // 조건을 만족한 경우 결과 반환
        else{
            $.ajax({
                type:"post",
                url: "{% url 'reviews:updatereview' %}",
                data : form_array,
                success:function(data){
                    alert(data)
                    alert("리뷰 작성이 완료되었습니다")
                }
            })
        }
    });
</script>
{% endblock %}