{% extends 'bookmmelier_base.html' %}
{% block content %}
{% load static %}
<section class="container" id="main">
  <div class="row">
    <div class="col-12">
      <span class="main-title">토론</span>
    </div>
  </div>


  <!-- 토론 생성 -->
  <a href="{% url 'debates:create' %}"> [토론 생성]</a>

  <div class="content-container">
    <div class="content-title">
      인기 토론
    </div>
    <!-- 인기 토론 아이템 -->
    <div class="col-12 debate-container" onclick="location.href='#'">
      <div class="title">남는 체력이 읎어</div>
      <div class="status">
        <div class="status-item">
          <i class="fa-regular fa-user"></i>
          56
        </div>
        <div class="status-item">
          <i class="fa-regular fa-comment"></i>
          250
        </div>
      </div>
    </div>

  </div>

  <div class="col-12">
    <div class="content-container">
      <div class="content-title">
        도서별 주제
      </div>

      <!-- 도서 선택 버튼-->
      <div class="select" onClick="javascript:popOpen();">
        선택된 책이 없습니다. 도서를 선택해주세요.
        <br>
        +
      </div>

      <!-- 선택된 도서 정보 -->
      <div class="small-content" style="margin-bottom: 50px;">
        <div class="content-title">
          도서정보
        </div>
        <div class="book-container">
          <img src="./static/img/bookcover.png">
          <div class="metadata">
            <div class="title">
              문과 출신입니다만
            </div>
            <div class="row justify-content-between">
              <table class="bibil-small">
                <tr>
                  <th>저자</th>
                  <td>자청</td>
                  <th>출판사</th>
                  <td>자청</td>
                  <th>출판년도</th>
                  <td>2022</td>
                </tr>
                <tr>
                  <th>주제</th>
                  <td>한국문학</td>
                  <th>ISBN</th>
                  <td>978000000</td>
                  <th></th>
                  <td></td>
                </tr>
              </table>
              <div class="shortcut-container">
                <div class="shortcut-desc">
                  원하는 주제가 없나요?
                </div>
                <div class="shortcut-icon">
                  <i class="fa-solid fa-file-circle-plus"></i>
                </div>
                <div class="shortcut-title">
                  토론방 만들기
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-8">
          <!-- 토론 검색 기능 -->
          <div class="search">
            <form action="#" method="GET">
              <input type="text" name="search" placeholder="도서명, 저자, 출판사 등을 입력해주세요">
              <i class='fa-solid fa-magnifying-glass'></i>
            </form>
          </div>
        </div>
        <div class="col-4 justify-content-evenly">
          <div class="sort"><a href='#'>참가자 많은 순</a></div>
          <div class="sort"><a href='#'>글 많은 순</a></div>
          <div class="sort"><a href='#'>최신순</a></div>
        </div>
      </div>

      <!-- 토론 리스트 -->
      <div class="col-12 debate-container" onclick="location.href='#'">
        <div class="title">남는 체력이 읎어</div>
        <div class="status">
          <div class="status-item">
            <i class="fa-regular fa-user"></i>
            56
          </div>
          <div class="status-item">
            <i class="fa-regular fa-comment"></i>
            250
          </div>
        </div>
      </div>
    </div>
  </div>
</section>


<!--modal-->
<div class="modal-bg" onClick="javascript:popClose();"></div>
<div class="modal-wrap">
  <div class="container">
    <button class="modal-close" onClick="javascript:popClose();">X</button>
    <div class="title">
      도서검색
    </div>
    <div class="search">
      <form action="#" method="GET">
        <input type="text" name="search" placeholder="도서명, 저자, 출판사 등을 입력해주세요">
        <i class='fa-solid fa-magnifying-glass'></i>
      </form>
    </div>
  </div>
  <div class="book-items">
    <div class="item">
      <img src="./static/img/bookcover.png">
      <div class="metadata">
        <div class="title">
          문과 출신입니다만
        </div>
        <table class="bibil">
          <tr>
            <th>저자</th>
            <td>자청</td>
            <th>출판사</th>
            <td>자청</td>
            <th>출판년도</th>
            <td>2022</td>
          </tr>
          <tr>
            <th>주제</th>
            <td>한국문학</td>
            <th>ISBN</th>
            <td>978000000</td>
            <th></th>
            <td></td>
          </tr>
        </table>
        <div class="desc">
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Quidem praesentium maiores
          dolorem
          autem recusandae, quisquam, itaque earum a nostrum non illo similique sunt vel rerum
          voluptatibus. Nostrum commodi ipsa ex?
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Quidem praesentium maiores
          dolorem
          autem recusandae, quisquam, itaque earum a nostrum non illo similique sunt vel rerum
          voluptatibus. Nostrum commodi ipsa ex?
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Quidem praesentium maiores
          dolorem
          autem recusandae, quisquam, itaque earum a nostrum non illo similique sunt vel rerum
          voluptatibus. Nostrum commodi ipsa ex?
          autem recusandae, quisquam, itaque earum a nostrum non illo similique sunt vel rerum
          voluptatibus. Nostrum commodi ipsa ex?
        </div>
      </div>
    </div>
  </div>
</div>



<h3>도서별 주제</h3>
<!-- 도서 선택 모달 -->
<a href="#" data-toggle="modal" data-target="#myModal">도서 불러오기</a>

<div class="modal fade" id="myModal" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">도서 검색</h4>
        <div>
          <select name="search_type" id="search_type">
            <option value="전체">전체</option>
            <option value="제목">제목</option>
            <option value="작가">작가</option>
            <option value="출판사">출판사</option>
          </select>
          <input id="search_input" type="search" />
          <button id="search_button" type="submit">검색</button>
        </div>

        <button type="button" class="close" data-dismiss="modal">
          &times;
        </button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <!-- 도서목록 부분 -->
        <div id="search_result_table">
          {% include 'debates_list_search_result.html' %}
        </div>
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
          Close
        </button>
      </div>
    </div>
  </div>
</div>


<div id="modal"></div>


<!-- 도서별 토론 목록 -->
{% include 'debates_list_selected_book.html' %}
</div>


<script>
  $("#search_button").click(function () {
    $.ajax({
      type: "get",
      url: "{% url 'debates:list_search_Books' %}",
      data: {
        search_input: $("#search_input").val(),
        search_type: $("#search_type").val(),
      },
      success: function (data) {
        $("#search_result_table").html(data);
      },
    });
  });

  $(document).on("click", ".first_page", function () {
    num_pages = parseInt($(".now_page").first().text());
    page_click();
  });

  $(document).on("click", ".last_page", function () {
    num_pages = parseInt($(".now_page").last().text());
    page_click();
  });

  $(document).on("click", ".now_page", function () {
    num_pages = parseInt($(this).text());
    page_click();
  });

  function page_click() {
    $.ajax({
      type: "get",
      url: "{% url 'debates:list_search_Books' %}",
      data: {
        search_input: $("#search_input").val(),
        search_type: $("#search_type").val(),
        page: num_pages,
      },
      success: function (data) {
        $("#search_result_table").html(data);
      },
    });
  }

  $(document).on("click", ".book_title", function () {
    $.ajax({
      type: "post",
      url: "{% url 'debates:list_select_Books' %}",
      data: {
        isbn13: $(this).attr("value"),
        csrfmiddlewaretoken: "{{ csrf_token }}",
      },
      success: function (data) {
        $("#selected_book").html(data);
      },
    });
  });
</script>
{% endblock %}